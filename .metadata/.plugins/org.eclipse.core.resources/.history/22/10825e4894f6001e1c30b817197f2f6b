package core;

import hla.rti1516_202X.AttributeHandle;
import hla.rti1516_202X.AttributeHandleSet;
import hla.rti1516_202X.AttributeHandleValueMap;
import hla.rti1516_202X.CallbackModel;
import hla.rti1516_202X.FederateAmbassador;
import hla.rti1516_202X.FederateHandle;
import hla.rti1516_202X.FederateHandleSaveStatusPair;
import hla.rti1516_202X.FederateHandleSet;
import hla.rti1516_202X.FederateRestoreStatus;
import hla.rti1516_202X.FederationExecutionInformationSet;
import hla.rti1516_202X.FederationExecutionMemberInformationSet;
import hla.rti1516_202X.InteractionClassHandle;
import hla.rti1516_202X.LogicalTime;
import hla.rti1516_202X.MessageRetractionHandle;
import hla.rti1516_202X.ObjectClassHandle;
import hla.rti1516_202X.ObjectInstanceHandle;
import hla.rti1516_202X.OrderType;
import hla.rti1516_202X.ParameterHandle;
import hla.rti1516_202X.ParameterHandleValueMap;
import hla.rti1516_202X.RTIambassador;
import hla.rti1516_202X.ResignAction;
import hla.rti1516_202X.RestoreFailureReason;
import hla.rti1516_202X.RtiConfiguration;
import hla.rti1516_202X.RtiFactory;
import hla.rti1516_202X.RtiFactoryFactory;
import hla.rti1516_202X.SaveFailureReason;
import hla.rti1516_202X.SynchronizationPointFailureReason;
import hla.rti1516_202X.TransportationTypeHandle;
import hla.rti1516_202X.encoding.DecoderException;
import hla.rti1516_202X.encoding.EncoderException;
import hla.rti1516_202X.encoding.EncoderFactory;
import hla.rti1516_202X.encoding.HLAunicodeString;
import hla.rti1516_202X.exceptions.AlreadyConnected;
import hla.rti1516_202X.exceptions.CouldNotOpenFOM;
import hla.rti1516_202X.exceptions.ErrorReadingFOM;
import hla.rti1516_202X.exceptions.FederateAlreadyExecutionMember;
import hla.rti1516_202X.exceptions.FederateInternalError;
import hla.rti1516_202X.exceptions.FederateIsExecutionMember;
import hla.rti1516_202X.exceptions.FederateOwnsAttributes;
import hla.rti1516_202X.exceptions.FederateServiceInvocationsAreBeingReportedViaMOM;
import hla.rti1516_202X.exceptions.FederatesCurrentlyJoined;
import hla.rti1516_202X.exceptions.FederationExecutionAlreadyExists;
import hla.rti1516_202X.exceptions.InconsistentFOM;
import hla.rti1516_202X.exceptions.InvalidFOM;
import hla.rti1516_202X.exceptions.InvalidResignAction;
import hla.rti1516_202X.exceptions.OwnershipAcquisitionPending;
import hla.rti1516_202X.exceptions.RTIexception;
import hla.rti1516_202X.exceptions.Unauthorized;
import hla.rti1516e.exceptions.AttributeNotDefined;
import hla.rti1516e.exceptions.AttributeNotOwned;
import hla.rti1516e.exceptions.CallNotAllowedFromWithinCallback;
import hla.rti1516e.exceptions.ConnectionFailed;
import hla.rti1516e.exceptions.CouldNotCreateLogicalTimeFactory;
import hla.rti1516e.exceptions.CouldNotOpenFDD;
import hla.rti1516e.exceptions.ErrorReadingFDD;
import hla.rti1516e.exceptions.FederateNotExecutionMember;
import hla.rti1516e.exceptions.FederationExecutionDoesNotExist;
import hla.rti1516e.exceptions.IllegalName;
import hla.rti1516e.exceptions.InconsistentFDD;
import hla.rti1516e.exceptions.InteractionClassNotDefined;
import hla.rti1516e.exceptions.InteractionClassNotPublished;
import hla.rti1516e.exceptions.InteractionParameterNotDefined;
import hla.rti1516e.exceptions.InvalidInteractionClassHandle;
import hla.rti1516e.exceptions.InvalidLocalSettingsDesignator;
import hla.rti1516e.exceptions.InvalidObjectClassHandle;
import hla.rti1516e.exceptions.NameNotFound;
import hla.rti1516e.exceptions.NotConnected;
import hla.rti1516e.exceptions.ObjectClassNotDefined;
import hla.rti1516e.exceptions.ObjectClassNotPublished;
import hla.rti1516e.exceptions.ObjectInstanceNameInUse;
import hla.rti1516e.exceptions.ObjectInstanceNameNotReserved;
import hla.rti1516e.exceptions.ObjectInstanceNotKnown;
import hla.rti1516e.exceptions.RTIinternalError;
import hla.rti1516e.exceptions.RestoreInProgress;
import hla.rti1516e.exceptions.SaveInProgress;
import hla.rti1516e.exceptions.SynchronizationPointLabelNotAnnounced;
import hla.rti1516e.exceptions.UnsupportedCallbackModel;

import java.io.BufferedReader;
import java.io.File;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.MalformedURLException;
import java.net.URL;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import java.util.Observable;
import java.util.Observer;
import java.util.Set;
import java.util.TimeZone;

import model.CommHub;
import model.Position;
import siso.smackdown.frame.FrameType;
import skf.config.Configuration;
import skf.core.SEEAbstractFederate;
import skf.core.SEEAbstractFederateAmbassador;
import skf.exception.PublishException;
import skf.exception.SubscribeException;
import skf.exception.UnsubscribeException;
import skf.exception.UpdateException;
import skf.model.interaction.modeTransitionRequest.ModeTransitionRequest;
import skf.model.object.annotations.ObjectClass;
import skf.model.object.executionConfiguration.ExecutionConfiguration;
import skf.model.object.executionConfiguration.ExecutionMode;
import skf.synchronizationPoint.SynchronizationPoint;
import skf.utility.JulianDateType;

public class CommHubFederate extends SEEAbstractFederate implements Observer, FederateAmbassador {

	private static final int MAX_WAIT_TIME = 10000;
	
	
	private CommHub commHub = null;
	private String local_settings_designator = null;
	
	private ModeTransitionRequest mtr = null;
	
	private SimpleDateFormat format = null;
	
	public String federateName = "CommHub";
	private final List<String> _args;
	private final BufferedReader _systemInput;
	private RTIambassador _rtiAmbassador;
	private InteractionClassHandle _communicationClassHandle;
	private ParameterHandle _messageParameterHandle;
	private ParameterHandle _senderParameterHandle;
	private ObjectInstanceHandle _userInstanceHandle;
	private AttributeHandle _nameAttributeHandle;
	private String _username;
	private volatile boolean _reservationComplete;
	private volatile boolean _reservationSucceeded;
	private final Object _reservationSemaphore = new Object();
	private EncoderFactory _encoderFactory;
	private final Map<ObjectInstanceHandle, Participant> _knownObjects = new HashMap();

	
	public CommHubFederate(SEEAbstractFederateAmbassador seefedamb, CommHub commHub, String[] var1) {
		super(seefedamb);
		this.commHub  = commHub;
		this.mtr = new ModeTransitionRequest();
		
		this.format =  new SimpleDateFormat("yyyy-MM-dd HH:mm:ss z");
		this._args = new ArrayList<String>(List.of(var1));
		this._systemInput = new BufferedReader(new InputStreamReader(System.in));
		format.setTimeZone(TimeZone.getTimeZone("UTC"));
	}
	
	private void pressEnterToShutDown() {
		try {
			System.out.println("Press <ENTER> to shutdown");
			this._systemInput.readLine();
		} catch (IOException var2) {
		}
	}

	@SuppressWarnings("unchecked")
	public void configureAndStart(Configuration config) throws ConnectionFailed, InvalidLocalSettingsDesignator, UnsupportedCallbackModel, 
														CallNotAllowedFromWithinCallback, RTIinternalError, CouldNotCreateLogicalTimeFactory, 
														FederationExecutionDoesNotExist, InconsistentFDD, ErrorReadingFDD, CouldNotOpenFDD, 
														SaveInProgress, RestoreInProgress, NotConnected, MalformedURLException, 
														FederateNotExecutionMember, NameNotFound, InvalidObjectClassHandle, AttributeNotDefined, 
														ObjectClassNotDefined, InstantiationException, IllegalAccessException, IllegalName, 
														ObjectInstanceNameInUse, ObjectInstanceNameNotReserved, ObjectClassNotPublished, 
														AttributeNotOwned, ObjectInstanceNotKnown, PublishException, UpdateException, 
														SubscribeException, InvalidInteractionClassHandle, InteractionClassNotDefined, 
														InteractionClassNotPublished, InteractionParameterNotDefined, UnsubscribeException, 
														InterruptedException, SynchronizationPointLabelNotAnnounced {
		// 1. configure the SKF framework
		super.configure(config);

		// 2. Connect on RTI
		/*
		 *For MAK local_settings_designator = "";
		 *For PITCH local_settings_designator = "crcHost=" + <crc_host> + "\ncrcPort=" + <crc_port>;
		 */
		local_settings_designator = "crcHost="+config.getCrcHost()+"\ncrcPort="+config.getCrcPort();
		super.connectToRTI(local_settings_designator);

		// 3. join the SEE Federation execution
		super.joinFederationExecution();
		
		// 4. Subscribe the Subject
		super.subscribeSubject(this);
		
		/*
		 * 5. Check if the federate is a Late Joiner Federate. 
		 * All the Federates of the SEE Teams must be Late Joiner.
		 */
		if(!SynchronizationPoint.INITIALIZATION_STARTED.isAnnounced()){
			
			// 6. Wait for the announcement of the Synch-Point "initialization_completed"
			super.waitingForAnnouncement(SynchronizationPoint.INITIALIZATION_COMPLETED, MAX_WAIT_TIME);

			/* 7. Wait for announcement of "objects_discovered", and Federation
			 * Specific Mutiphase Initialization Synch-Points
			 */
			// -> skipped
			
			/* 8. Subscribe Execution Control Object Class Attributes
			 * and wait for ExCO Discovery
			 */
			super.subscribeElement((Class<? extends ObjectClass>) ExecutionConfiguration.class);
			super.waitForElementDiscovery((Class<? extends ObjectClass>) ExecutionConfiguration.class, MAX_WAIT_TIME);
			
			// 9. Request ExCO update
			while(super.getExecutionConfiguration() == null){
				super.requestAttributeValueUpdate((Class<? extends ObjectClass>) ExecutionConfiguration.class);
				Thread.sleep(10);
			}
				
			// 10. Publish MTR Interaction
			super.publishInteraction(this.mtr);
			
			/* 11. Publish and Subscribe Object Class Attributes
			 * and Interaction Class Parameters
			 * 
			 * 12. Reserve All Federate Object Instance Names
			 * 
			 * 13. Wait for All Federate Object Instance Name Reservation
			 * Success/Failure Callbacks
			 * 
			 * 14. Register Federate Object Instances
			 */
			super.publishElement(commHub, "CommHub");
			super.subscribeReferenceFrame(FrameType.AitkenBasinLocalFixed);
			
			// 15. Wait for All Required Objects to be Discovered
			// -> Skipped
			
			/* 16. Setup HLA Time Management and Query GALT, Compute HLTB and 
			 * Time Advance to HLTB
			 */
			super.setupHLATimeManagement();
			
			// 17. Achieve "objects_discovered" Sync-Point and wait for synchronization
			// -> Skipped
		}
		else
			throw new RuntimeException("The federate " + config.getFederateName() + "is not a Late Joiner Federate");
		
		//18. Start simulation execution
		super.startExecution();
		
	}

	@Override
	protected void doAction() {
		
		/* Time information related to the Federation */
		System.out.println("getFederationTime "+ this.getTime().getFederationTimeCycle());
		System.out.println(format.format(this.getTime().getFederationTimeAsCalendar().getTime()));
		
		RtiFactory var1 = null;
		try {
			var1 = RtiFactoryFactory.getRtiFactory();
		} catch (hla.rti1516_202X.exceptions.RTIinternalError e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		String var2 = "localhost";
		if (this._args.size() > 0) {
			var2 = (String) this._args.get(0);
		} else {
			System.out.println("Enter the CRC address, such as");
			System.out.println("'localhost', 'localhost:8989', '192.168.1.62'");
			System.out.println("or when using Pitch Booster on the form");
			System.out.println("<CRC name>@<booster address>:<booster port>");
			System.out.println("such as 'MyCRCname@192.168.1.70:8688'");
			System.out.println();
		}
		
		try {
			this._rtiAmbassador = var1.getRtiAmbassador();
		} catch (hla.rti1516_202X.exceptions.RTIinternalError e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		try {
			this._encoderFactory = var1.getEncoderFactory();
		} catch (hla.rti1516_202X.exceptions.RTIinternalError e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		RtiConfiguration var4 = RtiConfiguration.createConfiguration().withRtiAddress(var2);

		try {
			try {
				this._rtiAmbassador.connect(this, CallbackModel.HLA_IMMEDIATE, var4);
			} catch (hla.rti1516_202X.exceptions.ConnectionFailed e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} catch (hla.rti1516_202X.exceptions.UnsupportedCallbackModel e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} catch (AlreadyConnected e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} catch (hla.rti1516_202X.exceptions.CallNotAllowedFromWithinCallback e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} catch (hla.rti1516_202X.exceptions.RTIinternalError e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		} catch (Unauthorized var18) {
			System.out.println(var18.getMessage());
		}

		try {
			try {
				this._rtiAmbassador.destroyFederationExecution("COMMS");
			} catch (hla.rti1516_202X.exceptions.FederationExecutionDoesNotExist e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} catch (hla.rti1516_202X.exceptions.NotConnected e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} catch (hla.rti1516_202X.exceptions.RTIinternalError e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		} catch (Unauthorized | FederatesCurrentlyJoined var17) {
		}

		File var5 = new File("FederateA.xml");

		try {
			try {
				this._rtiAmbassador.createFederationExecution("COMMS", new URL[]{var5.toURI().toURL()}, "HLAfloat64Time");
			} catch (hla.rti1516_202X.exceptions.CouldNotCreateLogicalTimeFactory e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} catch (InconsistentFOM e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} catch (InvalidFOM e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} catch (ErrorReadingFOM e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} catch (CouldNotOpenFOM e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} catch (hla.rti1516_202X.exceptions.NotConnected e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} catch (hla.rti1516_202X.exceptions.RTIinternalError e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			} catch (MalformedURLException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		} catch (FederationExecutionAlreadyExists var15) {
		} catch (Unauthorized var16) {
			System.out.println(var16.getMessage());
			return;
		}

		try {
			this._rtiAmbassador.joinFederationExecution("CommHub", "COMMS", new URL[]{var5.toURI().toURL()});
		} catch (hla.rti1516_202X.exceptions.CouldNotCreateLogicalTimeFactory e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.FederationExecutionDoesNotExist e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (InconsistentFOM e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (InvalidFOM e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (ErrorReadingFOM e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (CouldNotOpenFOM e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.SaveInProgress e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.RestoreInProgress e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (FederateAlreadyExecutionMember e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (Unauthorized e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.NotConnected e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.CallNotAllowedFromWithinCallback e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.RTIinternalError e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (MalformedURLException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
		try {
			this._communicationClassHandle = this._rtiAmbassador.getInteractionClassHandle("Communication");
			this._messageParameterHandle = this._rtiAmbassador.getParameterHandle(this._communicationClassHandle, "Message");
			this._senderParameterHandle = this._rtiAmbassador.getParameterHandle(this._communicationClassHandle, "Sender");
			this._rtiAmbassador.subscribeInteractionClass(this._communicationClassHandle);
			this._rtiAmbassador.publishInteractionClass(this._communicationClassHandle);

			ObjectClassHandle var6 = this._rtiAmbassador.getObjectClassHandle("Participant");
			this._nameAttributeHandle = this._rtiAmbassador.getAttributeHandle(var6, "Name");
			AttributeHandleSet var7 = this._rtiAmbassador.getAttributeHandleSetFactory().create();
			var7.add(this._nameAttributeHandle);
			this._rtiAmbassador.subscribeObjectClassAttributes(var6, var7);
			this._rtiAmbassador.publishObjectClassAttributes(var6, var7);

			do {
				this._username = this.federateName;
				try {
					this._reservationComplete = false;
					this._rtiAmbassador.reserveObjectInstanceName(this._username);
					synchronized (this._reservationSemaphore) {
						while (!this._reservationComplete) {
							try {
								this._reservationSemaphore.wait();
							} catch (InterruptedException var14) {
							}
						}
					}

					if (!this._reservationSucceeded) {
						System.out.println("Federate already taken, try again.");
					}
				} catch (RTIexception var22) {
					System.err.println("RTI exception when reserving name: " + var22.getMessage());
					return;
				}
			} while (!this._reservationSucceeded);

			this._userInstanceHandle = this._rtiAmbassador.registerObjectInstance(var6, this._username);
			AttributeHandleValueMap var8 = this._rtiAmbassador.getAttributeHandleValueMapFactory().create(1);
			HLAunicodeString var9 = this._encoderFactory.createHLAunicodeString(this._username);
			var8.put(this._nameAttributeHandle, var9.toByteArray());
			this._rtiAmbassador.updateAttributeValues(this._userInstanceHandle, var8, (byte[]) null);
			System.out.println("Type messages you want to send. To exit, type . <ENTER>");

			while (true) {
				System.out.print("> ");
				String var10 = this._systemInput.readLine();
				if (var10.equals(".")) {
					this._rtiAmbassador.resignFederationExecution(ResignAction.DELETE_OBJECTS_THEN_DIVEST);

					try {
						this._rtiAmbassador.destroyFederationExecution("COMMS");
					} catch (FederatesCurrentlyJoined var13) {
					}

					this._rtiAmbassador.disconnect();
					this._rtiAmbassador = null;
					return;
				}

				ParameterHandleValueMap var11 = this._rtiAmbassador.getParameterHandleValueMapFactory().create(1);
				HLAunicodeString var12 = this._encoderFactory.createHLAunicodeString();
				var12.setValue(var10);
				var11.put(this._messageParameterHandle, var12.toByteArray());
				var11.put(this._senderParameterHandle, var9.toByteArray());
				this._rtiAmbassador.sendInteraction(this._communicationClassHandle, var11, (byte[]) null);
			}
		} catch (hla.rti1516_202X.exceptions.NameNotFound e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.FederateNotExecutionMember e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.NotConnected e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.RTIinternalError e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.InvalidInteractionClassHandle e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (FederateServiceInvocationsAreBeingReportedViaMOM e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.InteractionClassNotDefined e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.SaveInProgress e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.RestoreInProgress e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.InvalidObjectClassHandle e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.AttributeNotDefined e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.ObjectClassNotDefined e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.ObjectInstanceNameInUse e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.ObjectInstanceNameNotReserved e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.ObjectClassNotPublished e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (EncoderException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.AttributeNotOwned e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.ObjectInstanceNotKnown e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (InvalidResignAction e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (OwnershipAcquisitionPending e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (FederateOwnsAttributes e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.CallNotAllowedFromWithinCallback e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.FederationExecutionDoesNotExist e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (Unauthorized e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (FederateIsExecutionMember e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.InteractionClassNotPublished e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (hla.rti1516_202X.exceptions.InteractionParameterNotDefined e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		} catch (IOException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}

		
		Position curr_pos = this.commHub.getPosition();
		curr_pos.setX(curr_pos.getX()); // update the x coordinate

		try {

			super.updateElement(this.commHub);
			System.out.println(curr_pos);

		} catch (FederateNotExecutionMember | NotConnected | AttributeNotOwned
				| AttributeNotDefined | ObjectInstanceNotKnown | SaveInProgress
				| RestoreInProgress | RTIinternalError | IllegalName
				| ObjectInstanceNameInUse | ObjectInstanceNameNotReserved
				| ObjectClassNotPublished | ObjectClassNotDefined
				| UpdateException e) {
			e.printStackTrace();
		}

	}
	
	public void receiveInteraction(InteractionClassHandle var1, 
			   ParameterHandleValueMap var2, 
			   byte[] var3, 
			   OrderType var4, 
			   TransportationTypeHandle var5, 
			   FederateAmbassador.SupplementalReceiveInfo var6) {
		if (var1.equals(this._communicationClassHandle)) {
			if (!var2.containsKey(this._messageParameterHandle)) {
				System.err.println("Bad message received: No text.");
				return;
			}

			if (!var2.containsKey(this._senderParameterHandle)) {
				System.err.println("Bad message received: No sender.");
				return;
			}

			try {
				HLAunicodeString var7 = this._encoderFactory.createHLAunicodeString();
				HLAunicodeString var8 = this._encoderFactory.createHLAunicodeString();
				var7.decode((byte[]) var2.get(this._messageParameterHandle));
				var8.decode((byte[]) var2.get(this._senderParameterHandle));
				String var9 = var7.getValue();
				String var10 = var8.getValue();
				System.out.println(var10 + ": " + var9);
				System.out.print("> ");
			} catch (DecoderException var11) {
				System.err.println("Failed to decode incoming interaction");
			}
		}
		
	}
	
	public final void objectInstanceNameReservationSucceeded(String var1) {
		synchronized (this._reservationSemaphore) {
			this._reservationComplete = true;
			this._reservationSucceeded = true;
			this._reservationSemaphore.notifyAll();
		}
	}

	public final void objectInstanceNameReservationFailed(String var1) {
		synchronized (this._reservationSemaphore) {
			this._reservationComplete = true;
			this._reservationSucceeded = false;
			this._reservationSemaphore.notifyAll();
		}
	}

	public void removeObjectInstance(ObjectInstanceHandle var1, byte[] var2, OrderType var3, FederateHandle var4) {
		Participant var5 = (Participant) this._knownObjects.remove(var1);
		if (var5 != null) {
			System.out.println("[" + var5 + " has left]");
		}

	}
	
	public void reflectAttributeValues(ObjectInstanceHandle var1, 
			   AttributeHandleValueMap var2, 
			   byte[] var3, 
			   OrderType var4, 
			   TransportationTypeHandle var5, 
			   FederateAmbassador.SupplementalReflectInfo var6) {
		if (!this._knownObjects.containsKey(var1) && var2.containsKey(this._nameAttributeHandle)) {
			try {
				HLAunicodeString var7 = this._encoderFactory.createHLAunicodeString();
				var7.decode((byte[]) var2.get(this._nameAttributeHandle));
				String var8 = var7.getValue();
				Participant var9 = new Participant(var8);
				System.out.println("[" + var9 + " has joined]");
				System.out.print("> ");
				this._knownObjects.put(var1, var9);
			} catch (DecoderException var10) {
				System.err.println("Failed to decode incoming attribute");
			}
		}
	}
	
	public final void provideAttributeValueUpdate(ObjectInstanceHandle var1, AttributeHandleSet var2, byte[] var3) {
		if (var1.equals(this._userInstanceHandle) && var2.contains(this._nameAttributeHandle)) {
			try {
				AttributeHandleValueMap var4 = this._rtiAmbassador.getAttributeHandleValueMapFactory().create(1);
				HLAunicodeString var5 = this._encoderFactory.createHLAunicodeString(this._username);
				var4.put(this._nameAttributeHandle, var5.toByteArray());
				this._rtiAmbassador.updateAttributeValues(this._userInstanceHandle, var4, (byte[]) null);
			} catch (RTIexception var6) {
			}
		}

	}
	
	private static class Participant {
		private final String _name;

		Participant(String var1) {
			this._name = var1;
		}

		public String toString() {
			return this._name;
		}
	}

	@Override
	public void update(Observable arg0, Object arg1) {

		System.out.println("The CommHub has received an update");
		if(arg1 instanceof ExecutionConfiguration){
			super.setExecutionConfiguration((ExecutionConfiguration) arg1);
			
			/* Manage state transitions */
			if(super.getExecutionConfiguration().getCurrent_execution_mode() == ExecutionMode.EXEC_MODE_RUNNING &&
					super.getExecutionConfiguration().getNext_execution_mode() == ExecutionMode.EXEC_MODE_FREEZE){
				super.freezeExecution();
			}
			
			else if(super.getExecutionConfiguration().getCurrent_execution_mode() == ExecutionMode.EXEC_MODE_FREEZE &&
					super.getExecutionConfiguration().getNext_execution_mode() == ExecutionMode.EXEC_MODE_RUNNING){
				super.resumeExecution();
			}
			
			else if((super.getExecutionConfiguration().getCurrent_execution_mode() == ExecutionMode.EXEC_MODE_FREEZE || 
					super.getExecutionConfiguration().getCurrent_execution_mode() == ExecutionMode.EXEC_MODE_RUNNING ) &&
					super.getExecutionConfiguration().getNext_execution_mode() == ExecutionMode.EXEC_MODE_SHUTDOWN ){
				super.shudownExecution();
			}
			else
				System.out.println("ExecutionConfiguration status unknown");
			/* End Manage state transitions */
		}
		else
			System.out.println("Type not known!");

	}

	@Override
	public void connectionLost(String faultDescription) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void federateResigned(String reasonForResignDescription) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void reportFederationExecutions(FederationExecutionInformationSet federationExecutionInformationSet)
			throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void reportFederationExecutionMembers(String federationName,
			FederationExecutionMemberInformationSet federationExecutionMemberInformationSet)
			throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void reportFederationExecutionDoesNotExist(String federationName) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void synchronizationPointRegistrationSucceeded(String synchronizationPointLabel)
			throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void synchronizationPointRegistrationFailed(String synchronizationPointLabel,
			SynchronizationPointFailureReason reason) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void announceSynchronizationPoint(String synchronizationPointLabel, byte[] userSuppliedTag)
			throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void federationSynchronized(String synchronizationPointLabel, FederateHandleSet failedToSyncSet)
			throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void initiateFederateSave(String label) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void initiateFederateSave(String label, LogicalTime<?, ?> time) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void federationSaved() throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void federationNotSaved(SaveFailureReason reason) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void federationSaveStatusResponse(FederateHandleSaveStatusPair[] response) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void requestFederationRestoreSucceeded(String label) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void requestFederationRestoreFailed(String label) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void federationRestoreBegun() throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void initiateFederateRestore(String label, String federateName, FederateHandle federateHandle)
			throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void federationRestored() throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void federationNotRestored(RestoreFailureReason reason) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void federationRestoreStatusResponse(FederateRestoreStatus[] response) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void startRegistrationForObjectClass(ObjectClassHandle theClass) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void stopRegistrationForObjectClass(ObjectClassHandle theClass) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void turnInteractionsOn(InteractionClassHandle theHandle) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void turnInteractionsOff(InteractionClassHandle theHandle) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void multipleObjectInstanceNameReservationSucceeded(Set<String> objectNames) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void multipleObjectInstanceNameReservationFailed(Set<String> objectNames) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void discoverObjectInstance(ObjectInstanceHandle theObject, ObjectClassHandle theObjectClass,
			String objectName, FederateHandle producingFederate) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void reflectAttributeValues(ObjectInstanceHandle theObject, AttributeHandleValueMap theAttributes,
			byte[] userSuppliedTag, OrderType sentOrdering, TransportationTypeHandle theTransport,
			LogicalTime<?, ?> theTime, OrderType receivedOrdering, SupplementalReflectInfo reflectInfo)
			throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void reflectAttributeValues(ObjectInstanceHandle theObject, AttributeHandleValueMap theAttributes,
			byte[] userSuppliedTag, OrderType sentOrdering, TransportationTypeHandle theTransport,
			LogicalTime<?, ?> theTime, OrderType receivedOrdering, MessageRetractionHandle retractionHandle,
			SupplementalReflectInfo reflectInfo) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void receiveInteraction(InteractionClassHandle interactionClass, ParameterHandleValueMap theParameters,
			byte[] userSuppliedTag, OrderType sentOrdering, TransportationTypeHandle theTransport,
			LogicalTime<?, ?> theTime, OrderType receivedOrdering, SupplementalReceiveInfo receiveInfo)
			throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void receiveInteraction(InteractionClassHandle interactionClass, ParameterHandleValueMap theParameters,
			byte[] userSuppliedTag, OrderType sentOrdering, TransportationTypeHandle theTransport,
			LogicalTime<?, ?> theTime, OrderType receivedOrdering, MessageRetractionHandle retractionHandle,
			SupplementalReceiveInfo receiveInfo) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void receiveDirectedInteraction(InteractionClassHandle interactionClass, ObjectInstanceHandle theObject,
			ParameterHandleValueMap theParameters, byte[] userSuppliedTag, OrderType sentOrdering,
			TransportationTypeHandle theTransport, SupplementalReceiveInfo receiveInfo) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void receiveDirectedInteraction(InteractionClassHandle interactionClass, ObjectInstanceHandle theObject,
			ParameterHandleValueMap theParameters, byte[] userSuppliedTag, OrderType sentOrdering,
			TransportationTypeHandle theTransport, LogicalTime<?, ?> theTime, OrderType receivedOrdering,
			SupplementalReceiveInfo receiveInfo) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void receiveDirectedInteraction(InteractionClassHandle interactionClass, ObjectInstanceHandle theObject,
			ParameterHandleValueMap theParameters, byte[] userSuppliedTag, OrderType sentOrdering,
			TransportationTypeHandle theTransport, LogicalTime<?, ?> theTime, OrderType receivedOrdering,
			MessageRetractionHandle retractionHandle, SupplementalReceiveInfo receiveInfo)
			throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void removeObjectInstance(ObjectInstanceHandle theObject, byte[] userSuppliedTag, OrderType sentOrdering,
			LogicalTime<?, ?> theTime, OrderType receivedOrdering, FederateHandle producingFederate)
			throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void removeObjectInstance(ObjectInstanceHandle theObject, byte[] userSuppliedTag, OrderType sentOrdering,
			LogicalTime<?, ?> theTime, OrderType receivedOrdering, MessageRetractionHandle retractionHandle,
			FederateHandle producingFederate) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void attributesInScope(ObjectInstanceHandle theObject, AttributeHandleSet theAttributes)
			throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void attributesOutOfScope(ObjectInstanceHandle theObject, AttributeHandleSet theAttributes)
			throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void turnUpdatesOnForObjectInstance(ObjectInstanceHandle theObject, AttributeHandleSet theAttributes)
			throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void turnUpdatesOnForObjectInstance(ObjectInstanceHandle theObject, AttributeHandleSet theAttributes,
			String updateRateDesignator) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void turnUpdatesOffForObjectInstance(ObjectInstanceHandle theObject, AttributeHandleSet theAttributes)
			throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void confirmAttributeTransportationTypeChange(ObjectInstanceHandle theObject,
			AttributeHandleSet theAttributes, TransportationTypeHandle theTransportation) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void reportAttributeTransportationType(ObjectInstanceHandle theObject, AttributeHandle theAttribute,
			TransportationTypeHandle theTransportation) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void confirmInteractionTransportationTypeChange(InteractionClassHandle theInteraction,
			TransportationTypeHandle theTransportation) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void reportInteractionTransportationType(FederateHandle theFederate, InteractionClassHandle theInteraction,
			TransportationTypeHandle theTransportation) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void requestAttributeOwnershipAssumption(ObjectInstanceHandle theObject,
			AttributeHandleSet offeredAttributes, byte[] userSuppliedTag) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void requestDivestitureConfirmation(ObjectInstanceHandle theObject, AttributeHandleSet offeredAttributes,
			byte[] userSuppliedTag) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void attributeOwnershipAcquisitionNotification(ObjectInstanceHandle theObject,
			AttributeHandleSet securedAttributes, byte[] userSuppliedTag) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void attributeOwnershipUnavailable(ObjectInstanceHandle theObject, AttributeHandleSet theAttributes,
			byte[] userSuppliedTag) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void requestAttributeOwnershipRelease(ObjectInstanceHandle theObject, AttributeHandleSet candidateAttributes,
			byte[] userSuppliedTag) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void confirmAttributeOwnershipAcquisitionCancellation(ObjectInstanceHandle theObject,
			AttributeHandleSet theAttributes) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void informAttributeOwnership(ObjectInstanceHandle theObject, AttributeHandleSet theAttributes,
			FederateHandle theOwner) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void attributeIsNotOwned(ObjectInstanceHandle theObject, AttributeHandleSet theAttributes)
			throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void attributeIsOwnedByRTI(ObjectInstanceHandle theObject, AttributeHandleSet theAttributes)
			throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void timeRegulationEnabled(LogicalTime<?, ?> time) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void timeConstrainedEnabled(LogicalTime<?, ?> time) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void flushQueueGrant(LogicalTime<?, ?> theTime, LogicalTime<?, ?> optimisticTime)
			throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void timeAdvanceGrant(LogicalTime<?, ?> theTime) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void requestRetraction(MessageRetractionHandle theHandle) throws FederateInternalError {
		// TODO Auto-generated method stub
		
	}

}
